function initializeTradeAnalyzer(e){populateTeamSelects([...new Set(e.map(e=>e.team))]),document.getElementById("team1-select").addEventListener("change",function(){populatePlayerSelect("team1-players",this.value,e)}),document.getElementById("team2-select").addEventListener("change",function(){populatePlayerSelect("team2-players",this.value,e)}),document.getElementById("analyze-btn").addEventListener("click",function(){analyzeTrade(e)})}function populateTeamSelects(e){const t=["team1-select","team2-select"];e.sort(),t.forEach(t=>{const n=document.getElementById(t);n.innerHTML='<option value="">Select Team</option>',e.forEach(e=>{n.innerHTML+=`<option value="${e}">${e}</option>`})})}function populatePlayerSelect(e,t,n){const o=document.getElementById(e);o.innerHTML="";const a=n.filter(e=>e.team===t);["QB","RB","WR","TE","K","D/ST"].forEach(e=>{const t=a.filter(t=>t.position===e).sort((e,t)=>t.ros_projection-e.ros_projection);if(t.length>0){const n=document.createElement("optgroup");n.label=e,t.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.text=`${e.name} (${e.avg_points} pts/g)`,n.appendChild(t)}),o.appendChild(n)}})}function analyzeTrade(e){const t=getSelectedPlayers("team1-players",e),n=getSelectedPlayers("team2-players",e);if(0===t.length||0===n.length)return void alert("Please select players from both teams");displayAnalysis({team1:analyzeTradeImpact(t,n),team2:analyzeTradeImpact(n,t)}),createTradeChart(t,n),document.getElementById("analysis-results").style.display="block"}function analyzeTradeImpact(e,t){const n=e.reduce((e,t)=>e+t.ros_projection,0),o=t.reduce((e,t)=>e+t.ros_projection,0);return{pointsGiving:n,pointsReceiving:o,netChange:o-n,positionImpact:analyzePositionImpact(e,t)}}function analyzePositionImpact(e,t){const n={};return["QB","RB","WR","TE","K","D/ST"].forEach(o=>{const a=e.filter(e=>e.position===o),i=t.filter(e=>e.position===o);(a.length>0||i.length>0)&&(n[o]={giving:a.reduce((e,t)=>e+t.ros_projection,0),receiving:i.reduce((e,t)=>e+t.ros_projection,0)})}),n}function displayAnalysis(e){["team1","team2"].forEach(t=>{const n=document.getElementById(`${t}-analysis`),o=e[t];let a=`\n            <div class="card-body">\n                <h5>Projected ROS Impact</h5>\n                <p>Giving up: ${o.pointsGiving.toFixed(1)} points</p>\n                <p>Receiving: ${o.pointsReceiving.toFixed(1)} points</p>\n                <p class="font-weight-bold ${o.netChange>0?"text-success":"text-danger"}">\n                    Net change: ${o.netChange.toFixed(1)} points\n                </p>\n                <h6>Position Impact:</h6>\n                <ul>\n        `;Object.entries(o.positionImpact).forEach(([e,t])=>{const n=t.receiving-t.giving;a+=`\n                <li>${e}: ${n>0?"+":""}${n.toFixed(1)} points</li>\n            `}),a+="</ul></div>",n.innerHTML=a})}function createTradeChart(e,t){const n={title:{text:"Trade Comparison",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["Points Giving","Points Receiving"],top:25},xAxis:{type:"category",data:[document.getElementById("team1-select").value,document.getElementById("team2-select").value]},yAxis:{type:"value",name:"Projected ROS Points"},series:[{name:"Points Giving",type:"bar",data:[e.reduce((e,t)=>e+t.ros_projection,0),t.reduce((e,t)=>e+t.ros_projection,0)]},{name:"Points Receiving",type:"bar",data:[t.reduce((e,t)=>e+t.ros_projection,0),e.reduce((e,t)=>e+t.ros_projection,0)]}]};echarts.init(document.getElementById("trade-chart")).setOption(n)}function getSelectedPlayers(e,t){const n=document.getElementById(e),o=Array.from(n.selectedOptions).map(e=>e.value);return t.filter(e=>o.includes(e.id.toString()))}document.addEventListener("DOMContentLoaded",function(){fetch("/assets/json/trade_analyzer/players_2025.json").then(e=>e.json()).then(e=>initializeTradeAnalyzer(e))});